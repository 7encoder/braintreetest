"use strict";(self.webpackChunkgform_stripe=self.webpackChunkgform_stripe||[]).push([[264],{4555:function(e,t,r){r.r(t),r.d(t,{default:function(){return ne}});var n=r(455),a=r(8564),s=r.n(a),i=r(2888),u=r(1860),o=r(9257),c=r(2592),d=r(8306),p=r(8081),f=function(e){var t=m(e);c.lockSubmission(t),window.gformShowSpinner(e);var r=(0,o.getNode)(".gform_button",t,!0);r.setAttribute("data-original-value",r.value),r.value=window.gform_stripe_theme_js_strings.processing_payment},l=function(e){c.ajax.resetSubmission(e);var t=m(e);if(t){var r=(0,o.getNode)(".gform_button",t,!0),n=r.getAttribute("data-original-value");n&&(r.value=n)}},m=function(e){return document.getElementById("gform_"+e)},_=function(e){var t=p.get(e,"feeds");if(!Array.isArray(t))return null;var r=t.find((function(e){return e.isActivated&&"gravityformsstripe"===e.addonSlug}));return void 0!==r?r:null},g=function(e,t){var r=(0,o.getNode)(".gfield--type-stripe_creditcard",m(e),!0);if(!r)return!1;if(r.closest('.gform_page[data-conditional-logic="hidden"]'))return!1;if("hidden"===r.dataset.conditionalLogic)return!1;if(!t)return!1;var n=function(e,t){var r="form_total"===t.paymentAmount?0:t.paymentAmount;return 100*window.gform.products.getPaymentAmount(e,r)}(e,t);return!(n<=0)},v=r(1873),b=r(7113),h=r(527),y=function(){return(0,b.A)((function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(0,v.A)(this,e),(0,h.A)(this,"getCard",(function(){return t.card})),(0,h.A)(this,"createCard",(function(e,r,n){return t.card=t.elements.create("card",{classes:e,style:r,hidePostalCode:n}),t.card})),(0,h.A)(this,"updateCard",(function(e,r,n){return t.card.update({classes:e,style:r,hidePostalCode:n}),t.card})),this.stripe=null,this.elements=null,this.card=null,this.publishableKey=r&&r.publishableKey?r.publishableKey:gform_stripe_theme_js_strings.publishable_key,this.init()}),[{key:"init",value:function(){try{this.stripe=Stripe(this.publishableKey,{apiVersion:"2020-08-27"})}catch(e){}this.elements=this.stripe.elements()}}])}(),x={},w={},k={},A=[],S=function(e){j(e)},j=function(){var e=(0,n.A)(s().mark((function e(t){var r,n,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.getFormConfig)("gform_theme_config/addon/stripe/elements",t);case 2:if(k=e.sent,T(t)){e.next=6;break}return e.abrupt("return");case 6:if(n=_(t),null!=(a=B(t,n))&&a.stripe){e.next=10;break}return e.abrupt("return");case 10:if(P(t),i=null===(r=window.gform_admin_config)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.is_block_editor,g(t,n)||i){e.next=16;break}return N(t,a),e.abrupt("return");case 16:C(t,n,a).on("change",(function(e){M(t,e.complete),e.error?O(t,e.error.message):P(t)})),T(t).style.display="block";case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(e,t,r){x=Object.keys(k.styles).length>0?JSON.parse(JSON.stringify(k.styles)):[],F(e,x);var n=!t||""!==t.billingInformation_address_zip,a=(0,u.A)({},k.cardClasses)||{},s=r.getCard();s&&s.destroy(),s=r.createCard(a,w,n);var i="input_".concat(e,"_").concat(k.ccFieldId,"_1");return document.getElementById(i).innerHTML="",s.mount("#".concat(i)),s},N=function(e,t){var r=t.getCard();r&&r.unmount(),T(e).style.display="none"},M=function(e,t){var r=T(e);t?r.classList.add("gf-card-complete"):r.classList.remove("gf-card-complete")},I=function(e){return T(e).classList.contains("gf-card-complete")},O=function(e,t){var r=T(e);if(r){var n=(0,o.getNode)(".validation_message",r,!0);n||(r.insertAdjacentHTML("beforeend",'<div class="gfield_description validation_message gfield_validation_message"></div>'),n=(0,o.getNode)(".validation_message",r,!0)),n.innerText=t,c.lockSubmission(m(e))}},P=function(e){var t=T(e),r=(0,o.getNode)(".validation_message",t,!0);r&&r.remove(),c.unlockSubmission(m(e))},T=function(e){return(0,o.getNode)("#gform_".concat(e," .gfield--type-stripe_creditcard"),document,!0)},F=function(e,t,r,n){if(0!==Object.keys(t).length){var a=document.getElementById("gform_"+e),s=getComputedStyle(a),u=a.querySelector(".gfield input");Object.keys(t).forEach((function(a){if("object"!==(0,i.A)(t[a])){if("object"!==(0,i.A)(t[a])){var o="";n?r&&r!==n?(o=L(a,x[n][r][a],s,u))&&(w[n][r][a]=o):(o=L(a,x[n][a],s,u))&&(w[n][a]=o):(o=L(a,x[a],s,u))&&(w[a]=o)}}else{n||(w[a]={}),n&&(w[n][a]={});var c=n||a;F(e,t[a],a,c)}}))}},L=function(e,t,r,n){var a="";if(0===t.indexOf("--")){var s=r.getPropertyValue(t);if(s)a=s;else{var i="fontSmoothing"===e?"-webkit-font-smoothing":e;a=(n?getComputedStyle(n):r).getPropertyValue(i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase())}}else a=t;return a.trim()},B=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=t&&t.publishableKey?"".concat(e,"_").concat(t.publishableKey):e;return A[r]||(A[r]=new y(t)),A[r]},E=function(){var e=(0,n.A)(s().mark((function e(t,r,n){var a,i,u,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.getFormConfig)("gform_theme_config/addon/stripe/elements",t);case 2:a=e.sent,i=a.timeout_seconds?Math.floor(a.timeout_seconds/2):10,u=0;case 5:if(!(u<=i)){e.next=16;break}return e.next=8,K(2e3);case 8:return e.next=10,D(r);case 10:if(o=e.sent,!["Active","Paid","Authorized","Failed"].includes(o.payment_status)){e.next=13;break}return e.abrupt("return",o.payment_status);case 13:u++,e.next=5;break;case 16:return e.abrupt("return","Processing");case 17:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),D=function(){var e=(0,n.A)(s().mark((function e(t){var r,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("action","gfstripe_elements_get_entry"),n.append("nonce",window.gform_stripe_theme_js_strings.get_entry_nonce),n.append("entry_id",t),e.next=6,fetch(window.gform_theme_config.common.form.ajax.ajaxurl,{method:"POST",body:n});case 6:return a=e.sent,e.prev=7,e.next=10,a.json();case 10:a=e.sent,e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(7),e.abrupt("return",!1);case 16:if(a.success&&null!==(r=a.data)&&void 0!==r&&r.entry){e.next=19;break}return e.abrupt("return",!1);case 19:return e.abrupt("return",a.data.entry);case 20:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=(0,n.A)(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){return e()}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=E,J=(0,o.runOnce)((function(){(0,o.addAsyncFilter)("gform/submission/pre_submission",z),(0,o.addAsyncFilter)("gform/ajax/post_ajax_submission",H)})),z=function(){var e=(0,n.A)(s().mark((function e(t){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.abort){e.next=2;break}return e.abrupt("return",t);case 2:if(r=t.form.dataset.formid,(0,o.getNode)(".gfield--type-stripe_creditcard-card",m(r),!0)){e.next=6;break}return e.abrupt("return",t);case 6:if(t.submissionType===c.SUBMISSION_TYPE_SUBMIT){e.next=8;break}return e.abrupt("return",t);case 8:if(n=_(r),g(r,n)){e.next=11;break}return e.abrupt("return",t);case 11:if(I(r)){e.next=15;break}return O(r,window.gform_stripe_theme_js_strings.card_error_message),t.abort=!0,e.abrupt("return",t);case 15:return f(r),t.submissionMethod=c.SUBMISSION_METHOD_AJAX,t.displayConfirmation=!1,e.abrupt("return",t);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=(0,n.A)(s().mark((function e(t){var r,n,a,i,u,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.submissionResult).data.submission_type===c.SUBMISSION_TYPE_SUBMIT){e.next=3;break}return e.abrupt("return",t);case 3:if(r&&r.success&&r.data.is_valid){e.next=5;break}return e.abrupt("return",t);case 5:if(n=t.form.dataset.formid,a=_(n)){e.next=9;break}return e.abrupt("return",t);case 9:if(g(n,a)){e.next=11;break}return e.abrupt("return",t);case 11:if(!r.data.is_spam){e.next=14;break}return c.ajax.displayConfirmation(n,r),e.abrupt("return",t);case 14:if(i=r.data.entry_id,u={},"product"!==a.transactionType){e.next=22;break}return e.next=19,$(n,i,a);case 19:u=e.sent,e.next=25;break;case 22:return e.next=24,X(n,i,a);case 24:u=e.sent;case 25:if(u.success){e.next=32;break}return O(n,null===(o=u)||void 0===o?void 0:o.errorMessage),l(n),e.next=30,Q();case 30:return R(n,i),e.abrupt("return",t);case 32:return e.next=34,V(n,i,r);case 34:return e.abrupt("return",t);case 35:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=(0,n.A)(s().mark((function e(t,r,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(t,r,n);case 2:if("Failed"!==e.sent){e.next=9;break}O(t,window.gform_stripe_theme_js_strings.payment_failed_message),l(t),R(t,r),e.next=13;break;case 9:return e.next=11,Y(t,r,n);case 11:n=e.sent,c.ajax.displayConfirmation(t,n);case 13:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),R=function(e,t){var r=gform.state.get(e,"stripe_failed_entries")||[];r.includes(t)||r.push(t),gform.state.set(e,"stripe_failed_entries",r)},Y=function(){var e=(0,n.A)(s().mark((function e(t,r,n){var a,i,u,c,d,p,f,l,m,_;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(p=new FormData).append("action","gfstripe_elements_handle_successful_entry"),p.append("nonce",window.gform_stripe_theme_js_strings.handle_successful_entry_nonce),p.append("entry_id",r),f=(0,o.getNode)("gform_theme_".concat(t)),l=(0,o.getNode)("gform_style_settings_".concat(t)),p.append("form_theme",null==f?void 0:f.value),p.append("form_style_settings",null==l?void 0:l.value),m=gform.state.get(t,"stripe_failed_entries")||"",p.append("stripe_failed_entries",JSON.stringify(m)),e.next=12,W(p);case 12:if((_=e.sent)&&_.success&&(null!==(a=_.data)&&void 0!==a&&a.confirmation_markup||null!==(i=_.data)&&void 0!==i&&i.confirmation_redirect)){e.next=16;break}return e.abrupt("return",n);case 16:return n.data.confirmation_redirect=null===(u=_.data)||void 0===u?void 0:u.confirmation_redirect,n.data.confirmation_type=null!==(c=_.data)&&void 0!==c&&c.confirmation_redirect?"redirect":"message",n.data.confirmation_markup=null===(d=_.data)||void 0===d?void 0:d.confirmation_markup,e.abrupt("return",n);case 20:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),$=function(){var e=(0,n.A)(s().mark((function e(t,r,n){var a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(t,r,n);case 2:if((a=e.sent).success){e.next=5;break}return e.abrupt("return",{success:!1,errorMessage:a.errorMessage});case 5:return i=B(t,n),e.next=8,i.stripe.confirmCardPayment(a.clientSecret,{payment_method:{card:i.getCard()}});case 8:return e.abrupt("return",{success:!0});case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),q=function(){var e=(0,n.A)(s().mark((function e(t,r,n){var a,i,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new FormData).append("action","gfstripe_elements_create_payment_intent"),i.append("nonce",window.gform_stripe_theme_js_strings.create_payment_intent_nonce),i.append("entry_id",r),i.append("feed_id",n.feedId),e.next=7,W(i);case 7:if((u=e.sent).success&&null!==(a=u.data)&&void 0!==a&&a.client_secret){e.next=10;break}return e.abrupt("return",{success:!1,errorMessage:u.data.message});case 10:return e.abrupt("return",{success:!0,clientSecret:u.data.client_secret});case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),X=function(){var e=(0,n.A)(s().mark((function e(t,r,n){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z(r,n);case 2:if((a=e.sent).success){e.next=5;break}return e.abrupt("return",{success:!1,errorMessage:null==a?void 0:a.errorMessage});case 5:return e.next=7,G(t,n,a.subscription);case 7:return e.abrupt("return",{success:!0});case 8:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Z=function(){var e=(0,n.A)(s().mark((function e(t,r){var n,a,i,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("action","gfstripe_elements_create_subscription"),a.append("nonce",window.gform_stripe_theme_js_strings.create_subscription_nonce),a.append("entry_id",t),a.append("feed_id",r.feedId),e.next=7,W(a);case 7:if((i=e.sent).success&&null!==(n=i.data)&&void 0!==n&&n.subscription){e.next=11;break}return u=window.gform_stripe_theme_js_strings.subscription_creation_error_message+" "+i.data.message,e.abrupt("return",{success:!1,errorMessage:u});case 11:return e.abrupt("return",{success:!0,subscription:i.data.subscription});case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),G=function(){var e=(0,n.A)(s().mark((function e(t,r,n){var a,i,u,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=B(t,r),u=null===(a=n.latest_invoice)||void 0===a?void 0:a.payment_intent,o={payment_method:{card:i.getCard()}},!u){e.next=9;break}return e.next=6,i.stripe.confirmCardPayment(u.client_secret,o);case 6:case 11:return e.abrupt("return",e.sent);case 9:return e.next=11,i.stripe.confirmCardSetup(n.pending_setup_intent.client_secret,o);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Q=function(){var e=(0,n.A)(s().mark((function e(t){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("action","gfstripe_increase_error_count"),r.append("nonce",window.gform_stripe_theme_js_strings.increase_error_count_nonce),r.append("form_id",t),e.next=6,W(r);case 6:return n=e.sent,e.abrupt("return",!(null==n||!n.success)&&(null==n?void 0:n.data));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=(0,n.A)(s().mark((function e(t){var r,n,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(window.gform_theme_config.common.form.ajax.ajaxurl,{method:"POST",body:t});case 2:return r=e.sent,e.prev=3,e.next=6,r.json();case 6:return a=e.sent,i=!(a.success||null!==(n=a.data)&&void 0!==n&&n.message),a.data=i?{message:window.gform_stripe_theme_js_strings.unknown_error_message}:a.data,e.abrupt("return",a);case 12:return e.prev=12,e.t0=e.catch(3),e.abrupt("return",{success:!1,data:{message:window.gform_stripe_theme_js_strings.unknown_error_message}});case 15:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}(),ee=J,te=function(e,t){if(Number(t.detail.formId)===Number(e)){var r=T(e);if(r){var n=Number(r.id.split("_").pop());t.detail.fields.includes(n)&&S(e)}}},re=function(){var e=(0,n.A)(s().mark((function e(t,r,n,a){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S(t);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),ne=function(e){S(e),p.watch(e,["products","feeds"],re),document.addEventListener("gform/conditionalLogic/applyRules/end",(function(t){te(e,t)})),ee()}}}]);